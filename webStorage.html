<!DOCTYPE html>
<html>
    <head>
      <meta name="renderer" content="webkit">
      <meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"/>
      <meta http-equiv="content-type" content="charset=utf-8">
      <!-- meta 详细信息 http://www.wzsky.net/html/Website/htmlcss/116165.html -->
      <!-- 设置所有缓存无效 -->
      <meta http-equiv="Expires"   CONTENT="0">
      <meta http-equiv="Cache-Control"   CONTENT="no-cache">
      <meta http-equiv="Pragma"   CONTENT="no-cache">
      <title>
        浏览器缓存理解
      </title>
      <!--[if lt IE8]>
      <script type="text/javascript" src="lib/json2.js"></script>
      <![endif]-->
    </head>
    
    <body>
      <h3>浏览器缓存理解</h3>
      
      <p>
        1.浏览器缓存：sessionStorage 作用范围；
        <input type="button" value="点击存入缓存" id="sSetBtn"/>
        <input type="button" value="点击删除缓存" id="sRemoveBtn" />
        <input type="button" value="点击查看缓存" id="sShowBtn" />
      </p>
      <p>
        <span id="sBtnTips"></span>
      </p>


      <p>
        2.浏览器缓存：cookie 用法(需在虚拟服务器运行， 放在tomcat根目录下)；
        <input type="button" value="点击存入缓存" id="cSetBtn"/>
        <input type="button" value="点击删除缓存" id="cRemoveBtn" />
        <input type="button" value="点击查看缓存" id="cShowBtn" />
      </p>
      <p>
        <span id="cBtnTips"></span>
      </p>


      <!-- 引入公用自定义文件，其包含cookie封装对象 -->
      <script type="text/javascript" src="utils/cookieUtil.js"></script>
      <script>
        
        var xq = {};
        init();

        function init() {
          initSessionDemo();
          initCookieDemo();
        }

        function initSessionDemo(){
          var session_storage, s_set_btn, s_remove_btn, s_show_btn, s_btn_tips;

          s_set_btn = document.getElementById('sSetBtn');
          s_remove_btn = document.getElementById('sRemoveBtn');
          s_show_btn = document.getElementById('sShowBtn');
          s_btn_tips = document.getElementById('sBtnTips');
          s_set_btn.onclick = sessionSetItem;
          s_remove_btn.onclick = sessionRemoveItem;
          s_show_btn.onclick = showSessionStorage;

          function sessionSetItem(event){
            // console.log('event: ', event);
            // console.log('this: ', this);
            // 检测 sessionStorage 能否多窗口(或选项卡)共存
            if (window.sessionStorage) {
              session_storage = window.sessionStorage;
              session_storage.setItem('xq', 'sb');
              s_btn_tips.innerHTML = '保存成功！';
            }else {
              s_btn_tips.innerHTML = '保存失败！';
            }
          }

          // 显示storage, 转成字符串显示，JSON对象赋值之，ie8（不包括IE8）以下浏览器需引入json3
          function showSessionStorage(){
            if (window.sessionStorage) {
              session_storage = window.sessionStorage;
              s_btn_tips.innerHTML = 'sessionStorage:' + JSON.stringify(session_storage);
            } else {
              s_btn_tips.innerHTML = '浏览器不支持sessionStorage';
            }
          }

          function sessionRemoveItem(event){
            // 检测 sessionStorage 能否多窗口(或选项卡)共存
            if (window.sessionStorage) {
              session_storage = window.sessionStorage;
              session_storage.removeItem('xq');
              s_btn_tips.innerHTML = '删除成功！';
            }else {
              s_btn_tips.innerHTML = '删除失败！';
            }
          }
        }

        // 启动cookie 事件
        function initCookieDemo(){
          var c_set_btn, c_remove_btn, c_show_btn, c_btn_tips;

          c_set_btn = document.getElementById('cSetBtn');
          c_remove_btn = document.getElementById('cRemoveBtn');
          c_show_btn = document.getElementById('cShowBtn');
          c_btn_tips = document.getElementById('cBtnTips');
          c_set_btn.onclick = cookieSetItem;
          c_remove_btn.onclick = cookieRemoveItem;
          c_show_btn.onclick = showCookie;

          function cookieSetItem(){
            // CookieUtil.set("xq", "sb");
            // setCookie("xq", "sb", 24, "/");
            CookieUtil2.set("xq", "sb");
            if (document.cookie != '') {
              c_btn_tips.innerHTML = '设置cookie成功！';
            }else{
              c_btn_tips.innerHTML = '设置cookie失败！';
            }
          }

          function cookieRemoveItem(){
            var _value = '';
            // CookieUtil.unset("xq");
            CookieUtil2.remove("xq");
            _value = CookieUtil2.get("xq");
            if (_value) {
              c_btn_tips.innerHTML = '删除cookie失败！';
            } else {
              c_btn_tips.innerHTML = '删除cookie成功！';
            }
          }

          function showCookie() {
            // var _value = CookieUtil.get("xq"),
            // var _value = getCookieValue("xq"),
            var _value = CookieUtil2.get("xq"),
            c_obj = {
              name: "xq",
              value: _value
            };

            c_btn_tips.innerHTML = JSON.stringify(c_obj);
          }

        }

        //hours为空字符串时,cookie的生存期至浏览器会话结束。hours为数字0时,建立的是一个失效的cookie,这个cookie会覆盖已经建立过的同名、同path的cookie（如果这个cookie存在）。
        function setCookie(name, value, hours, path) {
          var name = escape(name);
          var value = escape(value);
          var expires = new Date();
          expires.setTime(expires.getTime() + hours * 3600000);
          path = path == "" ? "" : ";path=" + path;
          _expires = (typeof hours) == "string" ? "" : ";expires=" + expires.toUTCString();
          document.cookie = name + "=" + value + _expires + path;
        }
        //获取cookie值
        function getCookieValue(name) {
          var name = escape(name);
          //读cookie属性，这将返回文档的所有cookie
          var allcookies = document.cookie;
          //查找名为name的cookie的开始位置
          name += "=";
          var pos = allcookies.indexOf(name);
          //如果找到了具有该名字的cookie，那么提取并使用它的值
          if (pos != -1) {                                             //如果pos值为-1则说明搜索"version="失败
              var start = pos + name.length;                  //cookie值开始的位置
              var end = allcookies.indexOf(";", start);        //从cookie值开始的位置起搜索第一个";"的位置,即cookie值结尾的位置
              if (end == -1) end = allcookies.length;        //如果end值为-1说明cookie列表里只有一个cookie
              var value = allcookies.substring(start, end); //提取cookie的值
              return unescape(value);                           //对它解码      
          }
          else return "";                               //搜索失败，返回空字符串
        }

        //删除cookie
        function deleteCookie(name, path) {
          var name = escape(name);
          var expires = new Date(0);
          path = path == "" ? "" : ";path=" + path;
          document.cookie = name + "=" + ";expires=" + expires.toUTCString() + path;
        }
        

      </script>

    </body>
</html>