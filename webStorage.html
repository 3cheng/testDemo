<!DOCTYPE html>
<html>
    <head>
      <meta name="renderer" content="webkit">
      <meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"/>
      <meta http-equiv="content-type" content="charset=utf-8">
      <!-- meta 详细信息 http://www.wzsky.net/html/Website/htmlcss/116165.html -->
      <!-- 设置所有缓存无效 -->
      <meta http-equiv="Expires"   CONTENT="0">
      <meta http-equiv="Cache-Control"   CONTENT="no-cache">
      <meta http-equiv="Pragma"   CONTENT="no-cache">
      <title>
        浏览器缓存理解
      </title>
      <!--[if lt IE8]>
      <script type="text/javascript" src="lib/json2.js"></script>
      <![endif]-->
    </head>
    
    <body>
      <h3>浏览器缓存理解</h3>
      
      <p>
        1.浏览器缓存：localStorage 作用范围；
        <input type="button" value="点击存入缓存" id="lSetBtn"/>
        <input type="button" value="点击删除缓存" id="lRemoveBtn" />
        <input type="button" value="点击查看缓存" id="lShowBtn" />
      </p>
      <p>
        <span id="lBtnTips"></span>
      </p>
      <br/>

      <p>
        2.浏览器缓存：sessionStorage 作用范围；
        <input type="button" value="点击存入缓存" id="sSetBtn"/>
        <input type="button" value="点击删除缓存" id="sRemoveBtn" />
        <input type="button" value="点击查看缓存" id="sShowBtn" />
      </p>
      <p>
        <span id="sBtnTips"></span>
      </p>
      <br/>

      <p>
        2.浏览器缓存：cookie 用法(需在虚拟服务器运行， 放在tomcat根目录下)；
        <input type="button" value="点击存入缓存" id="cSetBtn"/>
        <input type="button" value="点击删除缓存" id="cRemoveBtn" />
        <input type="button" value="点击查看缓存" id="cShowBtn" />
      </p>
      <p>
        <span id="cBtnTips"></span>
      </p>

      <!-- 引入公用自定义文件，其包含cookie封装对象 -->
      <script type="text/javascript" src="utils/cookieUtil.js"></script>
      <script>
        // 不是很准确的总结： 
        // 1.localStorage、sessionStorage 是html5 规范，IE8就支持了，不同浏览器总大小不同，大概为5MB； 
        // 2.cookie 比较老的缓存实现方式，不同浏览器支持的cookie 个数跟容量不同，容量大概4K;（http://www.cnblogs.com/henryhappier/archive/2011/03/03/1969564.html）
        // 3.webSql HTML5新增缓存机制，IE所有版本（包括edge） firefox均不支持， PC端目前基本无法投入使用；http://www.cnblogs.com/chuncn/archive/2010/11/22/1884783.html 
        // 4.IndexDb HTML5规范的另一缓存机制， 浏览器支持情况比web sql好一些； IE10(edge14仍是部分支持)开始部分支持， firefox、chrome、Opera全支持、safari8开始部分支持；实际开发同上，暂时鸡肋；

        var xq = {};
        init();

        function init() {
          // webSql IndexDb待加
          initlocalStorageDemo();
          initSessionDemo();
          initCookieDemo();
        }

        // sessionStorage 模块
        function initSessionDemo(){
          var session_storage, s_set_btn, s_remove_btn, s_show_btn, s_btn_tips;

          s_set_btn = document.getElementById('sSetBtn');
          s_remove_btn = document.getElementById('sRemoveBtn');
          s_show_btn = document.getElementById('sShowBtn');
          s_btn_tips = document.getElementById('sBtnTips');
          s_set_btn.onclick = sessionSetItem;
          s_remove_btn.onclick = sessionRemoveItem;
          s_show_btn.onclick = showSessionStorage;

          function sessionSetItem(event){
            // console.log('event: ', event);
            // console.log('this: ', this);
            // 检测 sessionStorage 能否多窗口(或选项卡)共存
            if (window.sessionStorage) {
              session_storage = window.sessionStorage;
              session_storage.setItem('xq', 'sb');
              s_btn_tips.innerHTML = '保存成功！';
            }else {
              s_btn_tips.innerHTML = '保存失败！';
            }
          }

          // 显示storage, 转成字符串显示，JSON对象赋值之，ie8（不包括IE8）以下浏览器需引入json3
          function showSessionStorage(){
            if (window.sessionStorage) {
              session_storage = window.sessionStorage;
              s_btn_tips.innerHTML = 'sessionStorage:' + JSON.stringify(session_storage);
            } else {
              s_btn_tips.innerHTML = '浏览器不支持sessionStorage';
            }
          }

          function sessionRemoveItem(event){
            // 检测 sessionStorage 能否多窗口(或选项卡)共存
            if (window.sessionStorage) {
              session_storage = window.sessionStorage;
              session_storage.removeItem('xq');
              s_btn_tips.innerHTML = '删除成功！';
            }else {
              s_btn_tips.innerHTML = '删除失败！';
            }
          }
        }

        // localStorage 模块， 2015年11月24日 编码风格较之前有所改变
        function initlocalStorageDemo(){
          var localStorage, lSetBtn, lRemoveBtn, lShowBtn, lBtnTips;

          lSetBtn = document.getElementById('lSetBtn');
          lRemoveBtn = document.getElementById('lRemoveBtn');
          lShowBtn = document.getElementById('lShowBtn');
          lBtnTips = document.getElementById('lBtnTips');
          lSetBtn.onclick = localSetItem;
          lRemoveBtn.onclick = localRemoveItem;
          lShowBtn.onclick = showLocalStorage;

          function localSetItem(event){
            if (window.localStorage) {
              localStorage = window.localStorage;
              localStorage.setItem('xq', 'sb');
              lBtnTips.innerHTML = '保存成功！';
            }else {
              lBtnTips.innerHTML = '保存失败！';
            }
          }

          // 显示storage, 转成字符串显示，JSON对象赋值之，ie8（不包括IE8）以下浏览器需引入json3
          function showLocalStorage(){
            if (window.localStorage) {
              localStorage = window.localStorage;
              lBtnTips.innerHTML = 'localStorage:' + JSON.stringify(localStorage);
            } else {
              lBtnTips.innerHTML = '浏览器不支持localStorage';
            }
          }

          function localRemoveItem(event){
            if (window.localStorage) {
              localStorage = window.localStorage;
              localStorage.removeItem('xq');
              lBtnTips.innerHTML = '删除成功！';
            }else {
              lBtnTips.innerHTML = '删除失败！';
            }
          }
        }

        // 启动cookie 事件
        function initCookieDemo(){
          var c_set_btn, c_remove_btn, c_show_btn, c_btn_tips;

          c_set_btn = document.getElementById('cSetBtn');
          c_remove_btn = document.getElementById('cRemoveBtn');
          c_show_btn = document.getElementById('cShowBtn');
          c_btn_tips = document.getElementById('cBtnTips');
          c_set_btn.onclick = cookieSetItem;
          c_remove_btn.onclick = cookieRemoveItem;
          c_show_btn.onclick = showCookie;

          function cookieSetItem(){
            CookieUtil.set("xq", "sb");
            if (document.cookie != '') {
              c_btn_tips.innerHTML = '设置cookie成功！';
            }else{
              c_btn_tips.innerHTML = '设置cookie失败！';
            }
          }

          function cookieRemoveItem(){
            var _value = '';
            CookieUtil.remove("xq");
            _value = CookieUtil.get("xq");
            if (_value) {
              c_btn_tips.innerHTML = '删除cookie失败！';
            } else {
              c_btn_tips.innerHTML = '删除cookie成功！';
            }
          }

          function showCookie() {
            var _value = CookieUtil.get("xq"),
            c_obj = {
              name: "xq",
              value: _value
            };

            c_btn_tips.innerHTML = JSON.stringify(c_obj);
          }
        }

      </script>

    </body>
</html>