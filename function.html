<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>
            函数理解
        </title>
    </head>
    
    <body>
        <h3>函数理解</h3>
        <script>
          // 函数 add可以实现连续的加法运算， 函数add的语法如下：
          // add(num1)(num2)(num3)...;
          // 使用举例：
          // add(10)(10) = 20
          // add(10)(20)(50) = 80
          // add(10)(20)(50)(100) = 180
          // 请使用js代码实现函数add
          function add(a) {
            var sum = a
            function f(b) {
              sum += b
              return f
            }
            f.toString = function() { return sum }
            return f
          }
          // alert(add(10)(20)(30))   //60
          //看结果的时候必须用alert ，因为alert接收的必须是字符串，所以它会自动调用toString()方法
          // console.log(add(20).toString());
          // 递归函数
          // 斐波那契数列实现
          function fibonac(n){
            if (n <= 0){
              return 0;
            }else if(n == 1){
              return 1;
            }else{
              return fibonac(n-1) + fibonac(n-2);
            }
          }
          function fibonac2(n){
            if (n <= 0){
              return 0;
            }else if(n == 1){
              return 1;
            }else{
              return arguments.callee(n-1) + arguments.callee(n-2);
            }
          }
          // var test_res = fibonac(8);
          // var test_res = fibonac2(8);
          // alert(test_res);
          // call apply 用法
          var a = {
            a_num: 2,
            a_str: '3'
          };
          function callFun(arg1, arg2, arg3){
            var a_num = 1;
            var arg_count = arg1 + arg2 + arg3;
            alert(this.a_num);
            alert(arg_count);
          }
          function applyFun(arg1, arg2, arg3){
            var a_str = '1';
            var arg_count = arg1 + arg2 + arg3;
            alert(this.a_str); 
            alert(arg_count);
          }
          // callFun.call(a, 1, 2, 3);
          // applyFun.apply(a, [1,2,3]);

          // 有关javascript函数对象（函数当对象字面量使用竟然不报错！） 来源：http://www.zhihu.com/question/31863910
          // "age:"被看作了标签语句（label statement）不会起作用
          function Persion(){
            age: 20;
          }
          // alert(Persion.age);

          Persion.age = 20;
          // alert(Persion.age);

          // 如何在JavaScript里指定一个对象作为上下文去eval字符串？
          // 来源 http://www.zhihu.com/question/31930691
          // 比如 d = {x: 1, y: 2} , expr = "x * 2 + y" , 然后evalWith(d, expr) 就返回4
          var d = {x:1, y:2};
          var expr = "x*2 + y";
          var imports = ''
          for(var k in d){
              if( !k.isPrototypeOf(d) ) {
                imports += 'var ' + k + ' = this.' + k + ';';
              }
          }
          // Assume that `expr` is an expression
          function evalWith(d, expr) { 
            // return new Function('with (this) { return ' + expr + ' }').call(d); 
            return (new Function(imports + 'return (' + expr + ')')).call(d)
          }
          // alert( evalWith(d, expr) );
        </script>
    </body>
</html>